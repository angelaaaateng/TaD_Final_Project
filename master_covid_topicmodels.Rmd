---
title: "COVID_TopicModel"
author: "Angela Teng"
date: "4/29/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Text as Data Final Project 
Lakshmi Menon, Angela Marie Teng

```{r include = FALSE}
# get current working directory
rm(list = ls())
getwd()  
# setwd("~/Data/articles")

# loading packages 
library(dplyr)
library(ggplot2)
library(xtable)
library(plyr)

library(rvest)
library(dplyr)

# Loading multiple packages
libraries <- c("foreign", "stargazer")
lapply(libraries, require, character.only=TRUE)
set.seed(100)
library(quanteda)
library("devtools")
# install.packages("textreadr")
library(textreadr)

# Load it into our environment
library(quanteda.corpora)
# library(quanteda)
# install.packages("readtext")
library(readtext)
# install.packages("spacyr")
library(spacyr)

# to check version
packageVersion("quanteda")


```

Loading in all the articles from rev.com:
```{r data_load, echo =TRUE}
# temp = list.files(pattern="*.txt")
# myfiles = lapply(temp, read.delim)

## the read in of a directory
data = read_dir('/Users/angelateng/Desktop/Github_Files_Teng/TaD_Final_Project/Data/articles')

summary(data)
typeof(data)
```

Selecting only articles that contain keywords per country: 
UK - UK, [Boris] Johnson
US - US, Trump 
New Zealand - New Zealand, [Jacinda] Ardern
Australia - Australia, [Scott] Morrison
Canada - Canada, [Justin] Trudeau

(this data is from Data/Articles folder)
```{r subset_data, echo=TRUE}
# select(data$document, matches("trump"))
# data[,grepl("trump", colnames("document"))]
# data[document]

# turn list into df
df <- data.frame(data)
# sanity check
df[1,1:2]

# subset countries by keyword
US_df <- df[grep(c("Donald|Trump|US|United States"), df$document),]
US_df

UK_df <- df[grep(c("Boris|Johnson|United Kingdom|UK"), df$document),]
UK_df


NZ_df <- df[grep(c("Jacinda|Ardern|New Zealand"), df$document),]
NZ_df


AU_df <- df[grep(c("Scott|Morrison|Australia"), df$document),]
AU_df

CA_df <- df[grep(c("Justin|Trudeau|Canada"), df$document),]
CA_df
```

Now, we want to preprocess our text and convert it into a dfm
```{r preprocessing, echo = TRUE}
# ?dfm
# ?corpus

US_df <- rename(US_df, c("content"="text"))
US_df

us_corp <- corpus(US_df)
us_corp

head(us_corp)
# a corpus consists ofs: (1) documents: text + doc level data (2) corpus metadata (3) extras (settings)
head(docvars(us_corp))  # document-level variables
metacorpus(us_corp)  # corpus-level variables

# ndoc identifies the number of documents in a corpus
ndocs_us <- ndoc(us_corp)
# this is because it's subdividedd into paragraph, rather than article.....
ndocs_us

us_corpusinfo <- summary(us_corp, n = ndocs_us)  # note n default is 100
head(us_corpusinfo)

# unique(us_corp$document)
# list of unique trump documents
US_uniq_docs <- unique(US_df$document)
US_uniq_docs 

US_briefing_apr1 <- corpus_subset(us_corp, document == "Apr 1, 2020Donald Trump and the Coronavirus Task Fo")
US_briefing_apr1


# Using data from the corpus
us_tokens_1 <- tokens(US_briefing_apr1, remove_punct = TRUE, stem = TRUE, remove_numbers = FALSE, remove_symbols = TRUE, remove_url = TRUE, tolower=TRUE, remove_hyphens=TRUE) 

# tokens
num_tokens_us_1 <- sum(lengths(us_tokens_1))
num_tokens_us_1

us_dfm_apr1 <- dfm(us_corp, tolower=TRUE, stem = TRUE,  remove = stopwords("english"), remove_punct = TRUE)
us_dfm_apr1

# write a function do to this for all trump documents 
US_uniq_docs[1]

```


Now that we have a DFM, we want to do basic exploratory data analysis
```{r eda, echo=TRUE}


```


R Webscraping Code 
```{r scrape_text, echo = TRUE}

# 
# scrapetext <- function(url, filename){
#   transcript <- read_html(uk_mar16)
#   
#   text <- transcript %>% 
#     rvest::html_nodes(xpath = "//div[contains(@class, 'fl-callout-text')]") %>% 
#     xml2::xml_find_all("div/p") %>% 
#     rvest::html_text()
# 
#   speakers <- transcript %>% 
#     rvest::html_nodes(xpath = "//div[contains(@class, 'fl-callout-text')]") %>% 
#     xml2::xml_find_all("div/p/text()[following-sibling::br]") %>% 
#     rvest::html_text() %>%
#     unique()
#   
#   speaker_fname = paste(filename, 'speakers.txt', sep = '_')
#   text_fname = paste(filename, 'text.txt', sep = '_')
#   write_file(speaker_fname, speakers)
#   write_file(text_fname, text)
# }
# 
# write_file <- function(fname, data){
#   fileConn<-file(fname)
#   writeLines(data, fileConn)
#   close(fileConn)  
# }
# 
# 
# d <- data.frame(urls, fnames)
# for(i in seq_len(nrow(d))) {
#   scrapetext(d[i,1], d[i,2])
# }
```


Saving... 
```{r echo=TRUE}
# save workspace
save.image("./workspace_project.RData")


rm(list = ls())

load("./workspace_project.RData")

```




